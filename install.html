
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installation &#8212; Looking Glass B4 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Looking Glass B4 documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="looking-glass-client">
<span id="id1"></span><h2>Looking Glass Client<a class="headerlink" href="#looking-glass-client" title="Permalink to this headline">¶</a></h2>
<p>This guide will step you through building the looking glass client from
source, before you attempt to do this you should have a basic
understanding of how to use the shell.</p>
<div class="section" id="building-the-application">
<span id="id2"></span><h3>Building the Application<a class="headerlink" href="#building-the-application" title="Permalink to this headline">¶</a></h3>
<div class="section" id="installing-build-dependencies">
<span id="id3"></span><h4>Installing Build Dependencies<a class="headerlink" href="#installing-build-dependencies" title="Permalink to this headline">¶</a></h4>
<p>These required libraries and tools should be installed first.</p>
<div class="section" id="required-dependencies">
<span id="id4"></span><h5>Required Dependencies<a class="headerlink" href="#required-dependencies" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>cmake</p></li>
<li><p>gcc | clang</p></li>
<li><p>fonts-freefont-ttf</p></li>
<li><p>libegl-dev</p></li>
<li><p>libgl-dev</p></li>
<li><p>libfontconfig1-dev</p></li>
<li><p>libgmp-dev</p></li>
<li><p>libsdl2-dev</p></li>
<li><p>libsdl2-ttf-dev</p></li>
<li><p>libspice-protocol-dev</p></li>
<li><p>make</p></li>
<li><p>nettle-dev</p></li>
<li><p>pkg-config</p></li>
</ul>
<div class="section" id="may-be-disabled">
<span id="id5"></span><h6>May be disabled<a class="headerlink" href="#may-be-disabled" title="Permalink to this headline">¶</a></h6>
<p>These dependencies are required by default, but may be omitted if their
feature is disabled when running <a class="reference internal" href="#client-building"><span class="std std-ref">cmake</span></a>.</p>
<ul class="simple">
<li><p>Disable with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DENABLE_BACKTRACE=no</span></code></p>
<ul>
<li><p>binutils-dev</p></li>
</ul>
</li>
<li><p>Disable with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DENABLE_X11=no</span></code></p>
<ul>
<li><p>libx11-dev</p></li>
<li><p>libxfixes-dev</p></li>
<li><p>libxi-dev</p></li>
<li><p>libxss-dev</p></li>
</ul>
</li>
<li><p>Disable with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DENABLE_WAYLAND=no</span></code></p>
<ul>
<li><p>libwayland-bin</p></li>
<li><p>libwayland-dev</p></li>
<li><p>wayland-protocols</p></li>
</ul>
</li>
</ul>
<p>You can fetch these dependencies on Debian systems with the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">binutils-dev</span> <span class="pre">cmake</span> <span class="pre">fonts-freefont-ttf</span> <span class="pre">libfontconfig1-dev</span>
<span class="pre">libsdl2-dev</span> <span class="pre">libsdl2-ttf-dev</span> <span class="pre">libspice-protocol-dev</span> <span class="pre">libx11-dev</span> <span class="pre">nettle-dev</span>
<span class="pre">wayland-protocols</span></code></p>
</div>
</div>
</div>
<div class="section" id="downloading">
<h4>Downloading<a class="headerlink" href="#downloading" title="Permalink to this headline">¶</a></h4>
<p>Either visit the Looking Glass website’s <a class="reference external" href="https://looking-glass.io/downloads">Download
Page</a>, or pull the lastest <strong>bleeding-edge
version</strong> with <code class="docutils literal notranslate"><span class="pre">git</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/gnif/LookingGlass.git
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the latest bleeding-edge client version,
you <em>MUST</em> download and install the corresponding host application.</p>
</div>
</div>
<div class="section" id="building">
<span id="client-building"></span><h4>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h4>
<p>If you’ve downloaded the source code as a zip file, simply unzip and cd into the
new directory. If you’ve cloned the repo with <code class="docutils literal notranslate"><span class="pre">git</span></code>, then <code class="docutils literal notranslate"><span class="pre">cd</span></code> into the
‘LookingGlass’ directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir client/build
<span class="nb">cd</span> client/build
cmake ../
make
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The most common compile error is related to backtrace support. This can be
disabled by adding the following option to the cmake command:
<strong>-DENABLE_BACKTRACE=0</strong>, however, if you disable this and need support for a
crash please be sure to use gdb to obtain a backtrace manually or there is
nothing that can be done to help you.</p>
</div>
<p>Should this all go well, you will build the <strong>looking-glass-client</strong>.
Before you run the client, you will first need
to configure either libvirt, or QEMU (whichever you prefer) then set
up the <strong>looking-glass-host</strong> service in your VM.</p>
<p>You can run the client from the build directory, add the build directory to your
path to call it from anywhere, or run this command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln -s <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/looking-glass-client /usr/local/bin/
</pre></div>
</div>
<p>from the build directory.</p>
</div>
</div>
<div class="section" id="libvirt-configuration">
<span id="id6"></span><h3>libvirt Configuration<a class="headerlink" href="#libvirt-configuration" title="Permalink to this headline">¶</a></h3>
<p>This article assumes you already have a fully functional libvirt domain with
PCI passthrough working on a dedicated monitor.</p>
<p>If you use virt-manager, this guide also applies to you, since virt-manager uses
libvirt as its back-end.</p>
<p><strong>If you are using QEMU directly, this does not apply to you.</strong></p>
<p>Add the following to your libvirt machine configuration inside the
‘devices’ section by running <code class="docutils literal notranslate"><span class="pre">virsh</span> <span class="pre">edit</span> <span class="pre">&lt;VM&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;VM&gt;</span></code> is the name of
your virtual machine.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;shmem</span> <span class="na">name=</span><span class="s">&#39;looking-glass&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;model</span> <span class="na">type=</span><span class="s">&#39;ivshmem-plain&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;size</span> <span class="na">unit=</span><span class="s">&#39;M&#39;</span><span class="nt">&gt;</span>32<span class="nt">&lt;/size&gt;</span>
<span class="nt">&lt;/shmem&gt;</span>
</pre></div>
</div>
<p>The memory size (show as 32 in the example above) may need to be
adjusted as per the <a class="reference internal" href="#determining-memory"><span class="std std-ref">Determining Memory</span></a> section.</p>
<div class="section" id="spice-server">
<span id="id7"></span><h4>Spice Server<a class="headerlink" href="#spice-server" title="Permalink to this headline">¶</a></h4>
<p>If you would like to use Spice to give you keyboard and mouse input
along with clipboard sync support, make sure you have a
<code class="docutils literal notranslate"><span class="pre">&lt;graphics</span> <span class="pre">type='spice'&gt;</span></code> device, then:</p>
<ul class="simple">
<li><p>Find your <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> device, and set <code class="docutils literal notranslate"><span class="pre">&lt;model</span> <span class="pre">type='none'/&gt;</span></code></p>
<ul>
<li><p>If you can’t find it, make sure you have a <code class="docutils literal notranslate"><span class="pre">&lt;graphics&gt;</span></code>
device, save and edit again</p></li>
<li><p>On older libvirt versions, just disable the device in Windows
Device Manager</p></li>
</ul>
</li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type='tablet'/&gt;</span></code> device, if you have one</p></li>
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type='mouse'/&gt;</span></code> device, if you don’t already have one</p></li>
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type='keyboard'</span> <span class="pre">bus='virtio'/&gt;</span></code> device to improve
keyboard usage</p>
<ul>
<li><p>This requires the <em>vioinput</em> driver from
<a class="reference external" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/">virtio-win</a>
to be installed in the guest</p></li>
</ul>
</li>
</ul>
<p>If you want clipboard synchronization please see
<a class="reference internal" href="faq.html#how-to-enable-clipboard-synchronization-via-spice"><span class="std std-ref">How to enable clipboard synchronization via SPICE</span></a></p>
</div>
<div class="section" id="apparmor">
<h4>AppArmor<a class="headerlink" href="#apparmor" title="Permalink to this headline">¶</a></h4>
<p>For libvirt versions before <strong>5.10.0</strong>, if you are using AppArmor, you
need to add permissions for QEMU to access the shared memory file. This
can be done by adding the following to
<em>/etc/apparmor.d/abstractions/libvirt-qemu</em>.</p>
<p><code class="docutils literal notranslate"><span class="pre">/dev/shm/looking-glass rw,</span></code></p>
</div>
</div>
<div class="section" id="qemu-commands">
<span id="id8"></span><h3>Qemu Commands<a class="headerlink" href="#qemu-commands" title="Permalink to this headline">¶</a></h3>
<p><strong>If you are using libvirt/virt-manager, then this does not apply to you.</strong></p>
<p>Add the following to the commands to your QEMU command line, adjusting
the <code class="docutils literal notranslate"><span class="pre">bus</span></code> parameter to suit your particular configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-device ivshmem-plain,memdev<span class="o">=</span>ivshmem,bus<span class="o">=</span>pcie.0 <span class="se">\</span>
-object memory-backend-file,id<span class="o">=</span>ivshmem,share<span class="o">=</span>on,mem-path<span class="o">=</span>/dev/shm/looking-glass,size<span class="o">=</span>32M
</pre></div>
</div>
<p>The memory size (shown as 32M in the example above) may need to be
adjusted as per <a class="reference internal" href="#determining-memory"><span class="std std-ref">Determining Memory</span></a> section.</p>
</div>
<div class="section" id="determining-memory">
<span id="id9"></span><h3>Determining Memory<a class="headerlink" href="#determining-memory" title="Permalink to this headline">¶</a></h3>
<p>You will need to adjust the memory size to be suitable for
your desired maximum resolution, with the following formula:</p>
<p><code class="docutils literal notranslate"><span class="pre">width</span> <span class="pre">x</span> <span class="pre">height</span> <span class="pre">x</span> <span class="pre">4</span> <span class="pre">x</span> <span class="pre">2</span> <span class="pre">=</span> <span class="pre">total</span> <span class="pre">bytes</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">total</span> <span class="pre">bytes</span> <span class="pre">/</span> <span class="pre">1024</span> <span class="pre">/</span> <span class="pre">1024</span> <span class="pre">=</span> <span class="pre">total</span> <span class="pre">megabytes</span> <span class="pre">+</span> <span class="pre">10</span></code></p>
<p>For example, for a resolution of 1920x1080 (1080p):</p>
<p><code class="docutils literal notranslate"><span class="pre">1920</span> <span class="pre">x</span> <span class="pre">1080</span> <span class="pre">x</span> <span class="pre">4</span> <span class="pre">x</span> <span class="pre">2</span> <span class="pre">=</span> <span class="pre">16,588,800</span> <span class="pre">bytes</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">16,588,800</span> <span class="pre">/</span> <span class="pre">1024</span> <span class="pre">/</span> <span class="pre">1024</span> <span class="pre">=</span> <span class="pre">15.82</span> <span class="pre">MB</span> <span class="pre">+</span> <span class="pre">10</span> <span class="pre">=</span> <span class="pre">25.82</span></code></p>
<p>You must round this value up to the nearest power of two, which for the
provided example is 32MB.</p>
</div>
<div class="section" id="shared-memory-file-permissions">
<span id="id10"></span><h3>Shared Memory File Permissions<a class="headerlink" href="#shared-memory-file-permissions" title="Permalink to this headline">¶</a></h3>
<p>The shared memory file used by IVSHMEM is found in <code class="docutils literal notranslate"><span class="pre">/dev/shm/looking-glass</span></code>.
By default, it is owned by QEMU, and does not give read/write permissions to
your user, which are required for Looking Glass to run properly.</p>
<p>You can use <cite>systemd-tmpfiles</cite> to create the file before running your VM,
granting the necessary permissions which allow Looking Glass to use the file
properly.</p>
<p>Create a new file <code class="docutils literal notranslate"><span class="pre">/etc/tmpfiles.d/10-looking-glass.conf</span></code>, and populate it
with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Type Path               Mode UID  GID Age Argument</span>

<span class="n">f</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="o">/</span><span class="n">looking</span><span class="o">-</span><span class="n">glass</span> <span class="mi">0660</span> <span class="n">user</span> <span class="n">kvm</span> <span class="o">-</span>
</pre></div>
</div>
<p>Change <code class="docutils literal notranslate"><span class="pre">UID</span></code> to the user name you will run Looking Glass with, usually your
own.</p>
</div>
</div>
<div class="section" id="looking-glass-service-windows">
<span id="id11"></span><h2>Looking Glass Service (Windows)<a class="headerlink" href="#looking-glass-service-windows" title="Permalink to this headline">¶</a></h2>
<p>You must first run the Windows VM with the changes noted above in either
the <a class="reference internal" href="#libvirt-configuration"><span class="std std-ref">libvirt Configuration</span></a> or <a class="reference internal" href="#qemu-commands"><span class="std std-ref">Qemu Commands</span></a> sections.</p>
<div class="section" id="installing-the-ivshmem-driver">
<span id="id12"></span><h3>Installing the IVSHMEM Driver<a class="headerlink" href="#installing-the-ivshmem-driver" title="Permalink to this headline">¶</a></h3>
<p>Windows will not prompt for a driver for the IVSHMEM device, instead, it
will use a default null (do nothing) driver for the device. To install
the IVSHMEM driver you will need to go into the device manager and
update the driver for the device “PCI standard RAM Controller” under the
“System Devices” node.</p>
<p>A signed Windows 10 driver can be obtained from Red Hat for this device
from the below address:</p>
<p><a class="reference external" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/</a></p>
<p>Please note that you must obtain version 0.1.161 or later.</p>
<p>If you encounter warnings or errors about driver signatures, ensure secure boot
is turned off in the bios/uefi settings of your virtual machine.</p>
<div class="section" id="a-note-about-ivshmem-and-scream-audio">
<span id="id13"></span><h4>A note about IVSHMEM and Scream Audio<a class="headerlink" href="#a-note-about-ivshmem-and-scream-audio" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Using IVSHMEM with Scream may interfere with Looking Glass, as they may try
to use the same device.</p>
</div>
<p>Please do not use the IVSHMEM plugin for Scream.
Use the default network transfer method. The IVSHMEM method induces
additional latency that is built into its implementation. When using
VirtIO for a network device the VM is already using a highly optimized
memory copy anyway so there is no need to make another one.</p>
<p>If you insist on using IVSHMEM for Scream—despite its inferiority to the
default network implementation—the Windows Host Application can be told
what device to use. Create a <code class="docutils literal notranslate"><span class="pre">looking-glass-host.ini</span></code> file in the same
directory as the looking-glass-host.exe file. In it, you can use the
<code class="docutils literal notranslate"><span class="pre">os:shmDevice</span></code> option like so:</p>
<div class="highlight-INI notranslate"><div class="highlight"><pre><span></span><span class="k">[os]</span>
<span class="na">shmDevice</span><span class="o">=</span><span class="s">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-the-windows-host-application">
<span id="id14"></span><h3>Using the Windows Host Application<a class="headerlink" href="#using-the-windows-host-application" title="Permalink to this headline">¶</a></h3>
<p>Start by downloading the correct version for your release from
<a class="reference external" href="https://looking-glass.io/downloads">https://looking-glass.io/downloads</a>. You can either choose between
<strong>Official Releases</strong>, which are stable; or <strong>Release Candidates</strong>, new versions
about to be stable, but haven’t passed validation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your <strong>looking-glass-client</strong> was created by building from the <strong>master
branch</strong> you have to pick the <strong>Bleeding Edge</strong> version.</p>
</div>
<p>Next, extract the zip archive using the commit hash for the password.
Then, run the <code class="docutils literal notranslate"><span class="pre">looking-glass-host-setup.exe</span></code> installer and install the host.
By default, the installer will install a service that
automatically starts the host application at boot. The installer can
also be installed in silent mode with the <code class="docutils literal notranslate"><span class="pre">/S</span></code> switch. You can find other
command line options with the <code class="docutils literal notranslate"><span class="pre">/h</span></code> switch.</p>
<p>The windows host application captures the windows desktop and stuffs the
frames into the shared memory via the shared memory virtual device,
without this Looking Glass will not function. It is critical that the
version of the host application matches the version of the client
application, as differing versions can be, and usually are,
incompatible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of 2020-10-23, Microsoft Defender is known to mark the
Looking-Glass host executable as a virus and in some cases will
automatically delete the file.</p>
</div>
</div>
</div>
<div class="section" id="running-the-client">
<span id="id15"></span><h2>Running the Client<a class="headerlink" href="#running-the-client" title="Permalink to this headline">¶</a></h2>
<p>The client command is the binary file: <strong>looking-glass-client</strong>. This
command should run after the Windows Host Application has started.</p>
<p>For an updated list of arguments visit:
<a class="reference external" href="https://github.com/gnif/LookingGlass/blob/master/client/README.md">https://github.com/gnif/LookingGlass/blob/master/client/README.md</a></p>
<p>Common options include <code class="docutils literal notranslate"><span class="pre">-s</span></code> for disabling spice, <code class="docutils literal notranslate"><span class="pre">-S</span></code> for disabling the
screen saver, and <code class="docutils literal notranslate"><span class="pre">-F</span></code> to automatically enter full screen.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/icon-128x128.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#looking-glass-client">Looking Glass Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#looking-glass-service-windows">Looking Glass Service (Windows)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-client">Running the Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="obs.html">OBS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_faq.html">Technical FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Looking Glass team</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Looking Glass B4 documentation</a></li>
      <li>Next: <a href="troubleshooting.html" title="next chapter">Troubleshooting</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Looking Glass team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/install.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>